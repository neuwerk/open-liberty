<?xml version="1.0" encoding="UTF-8"?>
<!-- 
  @(#) 1.3 autoFVT/src/jaxws/provider/source/buildTest.xml, WAS.websvcs.fvt, WAS85.FVT, cf011231.01 3/13/10 18:10:14 [8/8/12 06:55:53]

  Description: Build file for the JAX-WS Provider API tests
 
  Date        Author       Feature/Defect          Description
  12/05/06    sedov        D408880                 New File
  03/13/10    lizet        D643070                 2.2 RI upgrade
-->

<project basedir="." default="buildall" name="jwpv.source">

	<property name="componentName" value="jaxws/provider/source"/>
	<property name="test.name" value="jwpv.source" />
	
    <import file="../../jaxws-commons.xml" />

	<property name="test.base.dir" value="${FVT.base.dir}/src/${componentName}" />
	<property name="test.work.dir" value="${FVT.build.work.dir}/${test.name}" />
		
	<path id="componentClasspath">
	   <path refid="jaxws.classpath"/>
	</path>	

	<target name="buildall" depends="clean, init, server, client, test" /> 
  
	<target name="clean" depends="setenv">
		<echo message="${test.name} Cleaning..." />
		
		<delete quiet="true">
			<fileset dir="${FVT.build.installableApps.dir}" includes="${test.name}*App.ear" />
			<fileset dir="${FVT.build.lib.dir}" includes="${test.name}*.war" />
		</delete>

		<delete dir="${FVT.build.work.dir}/${test.name}" />
		<delete dir="${FVT.build.classes.dir}/${componentName}" />
		<delete dir="${FVT.build.classes.dir}/jaxws/provider/common" />
	</target>
	
	<target name="init" depends="setenv">
		<echo message="${test.name} Initializing..." />
		<mkdir dir="${FVT.build.classes.dir}"/>
		<mkdir dir="${FVT.build.lib.dir}"/>
		<mkdir dir="${FVT.build.installableApps.dir}"/>			
	</target>
	
	<target name="server" depends="setenv">
		<echo message="${test.name} Building Server..." />
		
		<mkdir dir="${FVT.build.work.dir}/${test.name}"/>
		
		<!-- copy server/TestCase files -->
		<copy todir="${test.work.dir}" overwrite="yes">
			<fileset dir="${test.base.dir}/etc">
				<include name="*.wsdl" />
				<include name="*.xml" />
				<include name="*.xsd" />				
			</fileset>
		
			<fileset dir="${FVT.base.dir}/src">
				<include name="${componentName}/**/server/**/*.java" />
				<include name="jaxws/provider/common/**/*.java" />				
			</fileset>
			
			<filterset>

				<filter token="HOST" value="${server1.hostName}" />
				<filter token="PORT" value="${server1.WC_defaulthost}" />
				
				<filter token="WSDL_LOCATION" value="${test.work.dir}" />
			</filterset>			
		</copy>	
		
		<xjc schema="${test.base.dir}/etc/schema.xsd"
			 destdir="${test.work.dir}" />
		
		<!-- build server/common files -->
        <javac compiler="modern"
            fork="true"
            srcdir="${test.work.dir}"
            destdir="${FVT.build.classes.dir}"
		    source="${build.tests.with.java.level}"
		    target="${build.tests.with.java.level}"
            includes="**/server/**/*.java,**/common/**/*.java">
            <classpath>
				<path refid="jaxws.classpath"/>
				<path refid="classpath"/>
			</classpath>
        </javac>

		<!-- generate web.xml -->
		<web-xml displayName="${test.name}"
				 file="${test.work.dir}/web.xml"
				 version="current">
			<servlet servletClass="jaxws.provider.source.wsfvt.server.DOMSourcePortImpl"
				     urlPattern="/services/SOAP11DOMSourceService" />
				     
			<servlet servletClass="jaxws.provider.source.wsfvt.server.JAXBSourcePortImpl"
			         urlPattern="/services/SOAP11JAXBSourceService" />
			         
			<servlet servletClass="jaxws.provider.source.wsfvt.server.SAXSourcePortImpl"
			         urlPattern="/services/SOAP11SAXSourceService" />
			         
			<servlet servletClass="jaxws.provider.source.wsfvt.server.StreamSourcePortImpl"
			         urlPattern="/services/SOAP11StreamSourceService" />
		
			<servlet servletClass="jaxws.provider.source.wsfvt.server.SourcePortImpl"
			         urlPattern="/services/SOAP11SourceService" />
				
			<servlet servletClass="jaxws.provider.source.wsfvt.server.SourceMessagePortImpl"
			         urlPattern="/services/SOAP11SourceMessageService" />
			
			<servlet servletClass="jaxws.provider.source.wsfvt.server.SOAP12SourcePortImpl"
			         urlPattern="/services/SOAP12SourceService" />
				
			<servlet servletClass="jaxws.provider.source.wsfvt.server.SOAP12SourceMessagePortImpl"
			         urlPattern="/services/SOAP12SourceMessageService" />			
		</web-xml>
		
		<!-- package wars/ears -->
		<war destfile="${FVT.build.lib.dir}/${test.name}.war"
		     webxml="${FVT.build.work.dir}/${test.name}/web.xml">
			<!-- include wsdl/schema files -->
			<zipfileset
                dir="${test.work.dir}"
                includes="*.wsdl, *.xsd"
                prefix="WEB-INF/wsdl"/>
			<!-- include source files -->
       	    <zipfileset
                    dir="${test.work.dir}"
                    includes="**/*.java"
                    prefix="WEB-INF/src"/>
    		<!-- include class files -->
			<classes dir="${FVT.build.classes.dir}">
				<include name="${componentName}/**/server/**/*.class" />
				<include name="jaxws/provider/**/common/**/*.class" />
			</classes>
		</war>    	
		
		<!-- generate application.xml -->
		<app-xml
			displayName="${test.name}"
			file="${test.work.dir}/application.xml"
			version="current">
			<webModule war="${test.name}.war" contextRoot="${test.name}" />
		</app-xml>
			
		<!-- package everything together -->
		<ear earfile="${FVT.build.installableApps.dir}/${test.name}App.ear"
		     appxml="${test.work.dir}/application.xml">
			<fileset dir="${FVT.build.lib.dir}" includes="${test.name}.war" />
			<metainf dir="${test.base.dir}/etc">
				<include name="was.policy" />
			</metainf>
		</ear>	
		
	</target>

	<target name="client" />
	
	<target name="test">	
		<echo message="${test.name} Building Test..." />
		
		<mkdir dir="${FVT.build.work.dir}/${test.name}"/>
		
		<readCellConfig prefix="server1" key="defaultServer" />
		
		<!-- copy server/TestCase files -->
		<copy todir="${test.work.dir}" overwrite="yes">
			<fileset dir="${test.base.dir}/etc">
				<include name="*.wsdl" />
				<include name="*.xsd" />
			</fileset>
		
			<fileset dir="${FVT.base.dir}/src">
				<include name="${componentName}/**/test/**/*.java" />
				<include name="jaxws/provider/common/**/*.java" />				
			</fileset>
			
			<filterset>
				<filter token="HOST" value="${server1.hostName}" />
				<filter token="PORT" value="${server1.WC_defaulthost}" />
			</filterset>			
		</copy>	
		
		<xjc schema="${test.base.dir}/etc/schema.xsd"
			 destdir="${test.work.dir}" />

		<!-- build test/common files -->
        <javac compiler="modern"
            fork="true"
            srcdir="${test.work.dir}"
            destdir="${FVT.build.classes.dir}"
            source="${build.tests.with.java.level}"
            target="${build.tests.with.java.level}"
            includes="**/test/**/*.java,**/common/**/*.java">
            <classpath>
				<path refid="jaxws.classpath"/>
				<path refid="classpath"/>
			</classpath>
        </javac>		
	</target>

</project>
