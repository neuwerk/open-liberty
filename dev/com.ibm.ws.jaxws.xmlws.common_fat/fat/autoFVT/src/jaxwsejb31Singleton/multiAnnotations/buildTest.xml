<?xml version="1.0"?>
<!DOCTYPE project [
        <!ENTITY instance SYSTEM "../../../instance.xml">
        <!ENTITY properties SYSTEM "../../xmls/properties.xml">
        <!ENTITY paths SYSTEM "../../xmls/path_refs.xml">
        <!ENTITY targets SYSTEM "../../xmls/targets.xml">
        <!ENTITY taskdefs SYSTEM "../../xmls/taskdefs.xml">
        <!ENTITY taskdefs_post_compile SYSTEM "../../xmls/taskdefs_post_compile.xml">
]>

<!--
      1.2, 7/26/10
    
    Change History:
    Date       UserId              Feature/Defect          Description
    ****************************************************************************
    11/19/09   varadan             F743-17947-01           New file    
    07/26/10   jtnguyen            658639.1                Add policy with all permission granted
-->

<project default="buildall" basedir=".">

    <!-- These are XML entity refs.  Basically these statements cause the
       files declared in the DOCTYPE at the top of the file to be imported
       into this build file.
    -->
    &instance;
    &properties;
    &paths;
    &targets;
    &taskdefs;
    &taskdefs_post_compile;

    <!-- This property should match the package name of the test class.  The
       property is used in the targets.xml file when running any of the
       component-run* targets for running a single test case class.
    -->
    <property name="componentName" value="jaxwsejb31Singleton/multiAnnotations/test" />
    <property name="verbose.output" value="false" />
    <!-- 
         This path id is used in the targets.xml file when running any of
         the component-run* targets.  This allows setting the classpath 
         for an individual test.
    -->
    <path id="componentClasspath">
        <path refid="thinclientclasspath" />
        <dirset dir="${FVT.build.classes.dir}">
            <include name="jaxwsejb31Singleton/multiAnnotations"/>            
        </dirset>
    </path>

    <!-- =================================
          target: init
         ================================= -->
     <target name="init" depends="setenv"
            description="--> Creates initial directories needed for tests">
        <antcall target="component-init" />
        <mkdir dir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations" />
        <mkdir dir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice" />
        <mkdir dir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/test" />
    </target>

    <!-- ================================= 
          target: clean              
         ================================= -->
    <target name="clean"
            description="--> clean any files, classes, or directories
                       so that a new copy of the test can be built and run">
        <delete dir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations" />
        <delete file="${FVT.build.installableApps.dir}/jwsejb31-anno-resource-ejbservice.ear" />
        <delete file="${FVT.build.lib.dir}/jwsejb31-anno-resource-ejbservice.jar" />
    </target>

    <!-- =================================
          target: buildall
         ================================= -->
    <target name="buildall"
            depends="clean, init, setenv, ejbservice, test, preinstall" />

    <!-- ================================= 
          target: ejbservice              
         ================================= -->
    <target name="ejbservice"
            depends="setenv"
            description="--> Compiles, generates, and packages the ejbservice" > 
        
        <!-- ================================= 
          target: compile_ejbservice              
         ================================= -->
        <javac compiler="modern" srcdir="${FVT.base.dir}/src/jaxwsejb31Singleton/multiAnnotations/ejbservice"
               destdir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice"
               deprecation="${deprecation}"
               verbose="${verbose.output}"
               debug="${debug}"
               source="${build.tests.with.java.level}"
               target="${build.tests.with.java.level}"
               failonerror="${failonerror}">
            <classpath refid="classpath" />
            <include name="**/*.java" />
        </javac>
       
        <!-- copy server's source to classes directory for debugging -->
        <copy todir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice">
              <fileset dir="${FVT.base.dir}/src/jaxwsejb31Singleton/multiAnnotations/ejbservice">
                 <include name="*.java" />
              </fileset>
        </copy>

        <!-- ================================= 
          target: wsgen_ejbservice              
         ================================= -->

        <wsgen genwsdl="true"
               keep="true"
               verbose="${verbose.output}"
               destdir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice"
               resourcedestdir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice"
               sei="jaxwsejb31Singleton.multiAnnotations.ejbservice.HelloRefSupplier">
            <classpath>
                <pathelement location="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice" />
                <path refid="classpath" />
            </classpath>
        </wsgen>

        <!-- ================================= 
          target: pkg_ejbservice              
         ================================= -->
        <!-- Get the cells config info -->
        <readCellConfig prefix="server1"
                        key="defaultServer"
                        verbose="${verbose.output}" />

        <mkdir dir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice/wsdl" />

        <!-- Move the wsdl and xsd because I can't seem to get an inline replacement for the url -->
        <copy todir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice/wsdl">
            <fileset dir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice">
                <include name="HelloRefSupplierService.wsdl" />
                <include name="HelloRefSupplierService_schema1.xsd" />
            </fileset>
        </copy>

        <replace file="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice/wsdl/HelloRefSupplierService.wsdl"
                 value="http://${server1.hostName}:${server1.WC_defaulthost}/jwsejb31-anno-ejbservice/HelloRefSupplierService">
            <replacefilter token="REPLACE_WITH_ACTUAL_URL" />
        </replace>

        <jar jarfile="${FVT.build.lib.dir}/jwsejb31-anno-resource-ejbservice.jar">
            <fileset dir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice">
                <include name="**/*class" />
                <include name="**/*java" />
            </fileset>
            <zipfileset dir="${FVT.base.dir}/src/jaxwsejb31Singleton/multiAnnotations/ejbservice/etc/" prefix="META-INF/">
                <include name="ejb-jar.xml" />
            </zipfileset>
            <zipfileset dir="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice/wsdl" prefix="META-INF/wsdl">
                <include name="*.wsdl" />
                <include name="*.xsd" />
            </zipfileset>
        </jar>

        <ear earfile="${FVT.build.installableApps.dir}/jwsejb31-anno-resource-ejbservice.ear"
             appxml="${FVT.base.dir}/src/jaxwsejb31Singleton/multiAnnotations/ejbservice/etc/application.xml">
            <fileset dir="${FVT.build.lib.dir}">
                <include name="jwsejb31-anno-resource-ejbservice.jar" />
            </fileset>
             <metainf dir="${FVT.base.dir}/src/jaxwsejb31Singleton/multiAnnotations/ejbservice/etc">
				<include name="was.policy" />
			</metainf>
           
        </ear>
    </target>

    <!-- ================================= 
          target: wsimport_test              
         ================================= -->
    <target name="wsimport_test"
            depends="setenv"
            description="--> Runs wsimport on services the test consumes">
            
        <!-- Get the cells config info -->
        <readCellConfig prefix="server1"
                        key="defaultServer"
                        verbose="${verbose.output}" />
                        
        <wsimport
                  wsdl="${FVT.build.classes.dir}/jaxwsejb31Singleton/multiAnnotations/ejbservice/wsdl/HelloRefSupplierService.wsdl"
                  destdir="${FVT.build.classes.dir}"
                  verbose="${verbose.output}"
                  package="jaxwsejb31Singleton.multiAnnotations.test"  
                  keep="true"
                  sourcedestdir="${FVT.build.classes.dir}">
        </wsimport>
    </target>

    <!-- ================================= 
	      target: test              
	     ================================= -->
    <target name="test"
            depends="setenv, wsimport_test"
            description="--> Compiles, imports, and packages test">
        <javac compiler="modern" srcdir="${FVT.base.dir}/src/jaxwsejb31Singleton/multiAnnotations/test"
               destdir="${FVT.build.classes.dir}"
               deprecation="${deprecation}"
               verbose="${verbose.output}"
               debug="${debug}"
               source="${build.tests.with.java.level}"
               target="${build.tests.with.java.level}"
               failonerror="${failonerror}">
            <classpath>
                <path refid="componentClasspath" />
            </classpath>
            <include name="**/*.java" />
        </javac>
    </target>

    <!-- ================================= 
		  target: preinstall              
		 ================================= -->
    <target name="preinstall"
            depends="setenv">
        <!--<endpointenable earfile="${FVT.build.installableApps.dir}/jwsejb31-anno-resource-ejbservice.ear" />-->
    </target>

    <!-- ================================= 
          target: install              
         ================================= -->
    <target name="install"
            depends="setenv, preinstall"
            description="--> Installs the App">
        <ant antfile="${FVT.base.dir}/src/jaxwsejb31Singleton/multiAnnotations/installTest.xml"
             dir="${FVT.base.dir}/src/jaxwsejb31Singleton/multiAnnotations">
            <property name="install.mode" value="${rt.install.mode}" />
        </ant>
    </target>

    <!-- ================================= 
          target: uninstall              
         ================================= -->
    <target name="uninstall"
            depends="setenv"
            description="--> Uninstalls the App">
        <ant antfile="${FVT.base.dir}/src/jaxwsejb31Singleton/multiAnnotations/uninstallTest.xml"
             dir="${FVT.base.dir}/src/jaxwsejb31Singleton/multiAnnotations">
            <property name="uninstall.mode" value="${rt.uninstall.mode}" />
        </ant>
    </target>
</project>
