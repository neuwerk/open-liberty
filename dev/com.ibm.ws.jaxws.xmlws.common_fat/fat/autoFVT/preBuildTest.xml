<?xml version="1.0"?>                     

<!--
   1.2, 7/31/07
   
   Change History:
   Date        UserId         Feature/Defect          Description
   04/19/2004  ulbricht       D199126                 New File
   07/09/2004  ulbricht       D215233                 Add wsanttasks.jar for Ant 1.6x
   07/24/2004  ulbricht       D213500                 Adjust for mantis
   07/30/2004  ulbricht       D219876                 Adjust for BobCat
   08/09/2004  ulbricht       D222729                 Adjust for z/OS
   08/16/2004  ulbricht       D224728                 Compile some tests on z/OS
   08/19/2004  ulbricht       D225528                 Some tests do not run on z/OS
   09/03/2004  ulbricht       D227113                 Add another test for recompile on z/OS
   09/10/2004  ulbricht       D230624                 Further specify Introspection compile
   11/29/2004  bothwell       D244857                 Add wrapped_inout test for recompile on z/OS
   02/15/2005  ulbricht       D243709                 Allow MultiProtocol test to run on z/OS
   02/22/2005  ulbricht       D257053                 Allow Https test to run on z/OS
   05/05/2005  ulbricht       D273606                 Change BobCat detection
   05/13/2005  ulbricht       D275916                 Remove detection of Ant version
   05/23/2005  ulbricht       D275916.1               Updates for componentization
   11/06/2005  ulbricht       D308997                 Samples test should compile from work dir
   01/13/2006  ulbricht       D336196                 Update classpath for v6.1
   01/26/2006  ulbricht       D287550.2               New test will not run on z/OS
   04/27/2006  ulbricht       365687                  Add OS390 jar
   07/31/2007  ulbricht       455649                  Change jar names
-->

<project default="setup" basedir=".">
                      
  <!-- This is the default target which will determine if any
       further setup is needed.
  -->                                                            
  <target name="setup">
    
    <!-- We'll key off the the class name of the publicly available WSDL2Java Ant
         task file to determine if BobCat is being tested.
    -->
    <condition property="product.bobcat">
      <not>
        <available classname="com.ibm.websphere.ant.tasks.WSDL2Java">
          <classpath>
            <pathelement location="${WAS.base.dir}/plugins/com.ibm.ws.runtime.jar"/>
          </classpath>
        </available>
      </not>
    </condition>
    <antcall target="setupBobcat"/>
  </target>                                 
                     
                                  
  <!-- If we are testing BobCat, then switch out the package/class
       names for the Ant tasks.  BobCat does not contain wsanttasks.jar.
  -->        
  <target name="setupBobcat" if="product.bobcat">
    <replace file="${FVT.base.dir}/src/xmls/taskdefs.xml"
             token="com.ibm.websphere.ant.tasks.WSDL2Java"
             value="com.ibm.ws.webservices.tools.ant.WSDL2JavaJ2EE"/>       
    <replace file="${FVT.base.dir}/src/xmls/taskdefs.xml"
             token="com.ibm.websphere.ant.tasks.Java2WSDL"
             value="com.ibm.ws.webservices.tools.ant.Java2WSDL"/>
  </target>                            
          

  <!-- z/OS requires some special setup before the tests can
       run.
  -->
  <target name="setupZOS">
  
    <!-- I only want this target to run once, so I'll
         add a file here and the shell script will only
         run this target if the file is not found.
    -->                                    
    <touch file="${FVT.base.dir}/setup-zos"/>
    
    <!-- The z/OS JDK needs special arguments for setting the default
         file encoding and so that any command line arguments are not
         translated.
    --> 
    <replace file="${FVT.base.dir}/src/build.xml">
      <replacetoken><![CDATA[<jvmarg value="-DFVT.base.dir=${FVT.base.dir}"/>]]></replacetoken>
      <replacevalue><![CDATA[<jvmarg value="-DFVT.base.dir=${FVT.base.dir}"/>
      <jvmarg value="-Dfile.encoding=ISO8859-1"/>
      <jvmarg value="-Xnoargsconversion"/>]]></replacevalue>
    </replace>
    <replace file="${FVT.base.dir}/src/xmls/targets.xml">
      <replacetoken><![CDATA[<jvmarg value="-DFVT.base.dir=${FVT.base.dir}"/>]]></replacetoken>
      <replacevalue><![CDATA[<jvmarg value="-DFVT.base.dir=${FVT.base.dir}"/>
      <jvmarg value="-Dfile.encoding=ISO8859-1"/>
      <jvmarg value="-Xnoargsconversion"/>]]></replacevalue>
    </replace>

    <!-- We're getting some ClassFormatErrors when compiling the tests
         on a distributed platform and then moving them to z/OS.  We'll
         compile the failing classes here until we can find out what's
         happening with the z/OS JDK.
    -->
    <javac compiler="modern" srcdir="${FVT.base.dir}/"
           destdir="${FVT.base.dir}/build/classes"
           debug="true"
           failonerror="false"
           deprecation="true">
      <classpath>
        <pathelement location="${WAS.base.dir}/plugins/com.ibm.ws.runtime.jar"/>
        <pathelement location="${WAS.base.dir}/plugins/com.ibm.ws.runtime.ws390.jar"/>
        <pathelement location="${WAS.base.dir}/lib/j2ee.jar"/>
        <pathelement location="${FVT.base.dir}/build/classes"/>
        <pathelement location="${WAS.base.dir}/samples/lib/WebServicesSamples/simpleClients.jar"/>
      </classpath>
      <include name="build/work/wsdl-ram/test/wsdl/ram/**/*.java"/>    
      <include name="build/work/wsdl-types/test/wsdl/types/**/*.java"/>    
      <include name="build/work/wsdl-nested/test/wsdl/nested/**/*.java"/>    
      <include name="build/work/wsdl-attachments/test/wsdl/attachments/**/*.java"/>    
      <include name="build/work/wsdl-apacheMime/test/wsdl/apacheMime/**/*.java"/>
      <include name="build/work/wsdl-wrapped_inout/test/wsdl/wrapped_inout/**/*.java"/>
      <include name="build/work/Introspection/com/**/*.java"/>
      <exclude name="src/Samples/**/SamplesTestCase.java"/>
      <include name="src/Samples/**/*.java"/>
      <include name="build/work/Samples/**/SamplesTestCase.java"/>
    </javac>
     
    <!-- Some of the tests do not run on z/OS.  Therefore, we'll delete
         them from the ${FVT.base.dir}/build/classes directory.
    -->
    <delete>
      <fileset dir="${FVT.base.dir}/build/classes" >
        <include name="**/*PmiTestCase.class"/>
        <include name="**/*TracingTestCase.class"/>
        <include name="**/*LoggingTestCase.class"/>
        <include name="**/*RoleContainerTestCase.class"/>
        <include name="**/*ValidationTestCase.class"/>
        <include name="**/*QuestionMarkWsdlTestCase.class"/>
        <include name="**/*Java2WsdlTestCase.class"/>
        <include name="**/*FfdcTestCase.class"/>
        <include name="**/*OnewayTestCase.class"/>
        <include name="**/*SyncTimeoutTestCase.class"/>
        <include name="**/*Wsdl2JavaRetryTestCase.class"/>
      </fileset>
    </delete>          
   
  </target>
  
</project>
